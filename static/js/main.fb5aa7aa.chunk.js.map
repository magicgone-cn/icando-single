{"version":3,"sources":["utils/index.js","model/Mission.js","modules/MissionEditor.js","modules/TodoList.js","modules/Storage.js","App.js","serviceWorker.js","index.js"],"names":["CHARS","split","GuidUtil","uuid","len","radix","i","r","chars","length","Math","random","join","uuidFast","Array","rnd","uuidCompact","replace","c","toString","Util","obj","includeNull","includeUndefined","undefined","Object","keys","ArrayUtil","array","NodeType","root","Symbol","for","normal","leaf","Mission","title","id","description","completed","expanded","children","parent","type","this","RootMission","redirectParentPointer","parentNode","forEach","node","MissionFactory","mission","assign","targetParentNode","clone","map","isEmpty","item","filter","index","slice","pointer","tempParentNode","Error","update","tempNode","refreshNode","data","convertMissionToData","keyFor","JSON","stringify","json","convertDataToMission","missionData","parse","extraInfo","completedKeys","Set","expandedKeys","add","parseExtraInfo","key","EditType","insert","delete","MissionEditor","props","handleSubmit","event","preventDefault","form","validateFields","errors","values","onChange","editType","getFieldDecorator","onSubmit","Item","label","hidden","initialValue","readOnly","rules","required","message","htmlType","block","formatButtonText","onClick","onCancel","React","Component","WrappedMissionEditor","Form","create","propTypes","TodoList","state","showCompleted","openEditor","promise","Promise","resolve","modal","Modal","info","icon","okButtonProps","style","display","content","destroy","callback","then","rootNode","rootMission","handleCompletedChange","checkedKeys","checked","renderTreeNodes","nodes","TreeNode","className","data-mission","actions","handleEdit","handleDelete","handleAdd","Meta","renderMission","marginRight","marginLeft","dataSource","rowKey","renderItem","parentMission","append","handleShowCompletedChange","setState","handleDrop","dragNode","dropTargetNode","relativePosition","dropPosition","parseInt","getLast","pos","dropTargetMission","dragMission","newDeletedNode","dropTargetIndex","indexOf","dropIndex","missionList","justify","textAlign","Title","checkedChildren","unCheckedChildren","minHeight","span","blockNode","checkStrictly","checkable","onCheck","draggable","onDrop","onSave","onExport","onImport","WrapperComponent","TodoListWithStorage","handleChange","handleSave","jsonStr","convertToJson","localStorage","setItem","handleLoad","rootMissionStr","getItem","createFromJson","handleExport","blob","Blob","a","document","createElement","download","href","window","URL","createObjectURL","dataset","downloadurl","click","handleImportInit","input","accept","addEventListener","file","path","files","fileReader","FileReader","onload","target","result","readAsText","importInput","handleImport","missionMap","App","Boolean","location","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.fb5aa7aa.chunk.js","sourcesContent":["// eslint-disable\r\n// Private array of chars to use\r\nconst CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');\r\nexport class GuidUtil {\r\n  static uuid = function (len, radix) {\r\n    var chars = CHARS, uuid = [], i;\r\n    radix = radix || chars.length;\r\n\r\n    if (len) {\r\n      // Compact form\r\n      for (i = 0; i < len; i++) uuid[i] = chars[0 | Math.random() * radix];\r\n    } else {\r\n      // rfc4122, version 4 form\r\n      var r;\r\n\r\n      // rfc4122 requires these characters\r\n      uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\r\n      uuid[14] = '4';\r\n\r\n      // Fill in random data.  At i==19 set the high bits of clock sequence as\r\n      // per rfc4122, sec. 4.1.5\r\n      for (i = 0; i < 36; i++) {\r\n        if (!uuid[i]) {\r\n          r = 0 | Math.random() * 16;\r\n          uuid[i] = chars[(i === 19) ? (r & 0x3) | 0x8 : r];\r\n        }\r\n      }\r\n    }\r\n\r\n    return uuid.join('');\r\n  };\r\n\r\n  // A more performant, but slightly bulkier, RFC4122v4 solution.  We boost performance\r\n  // by minimizing calls to random()\r\n  static uuidFast = function () {\r\n    var chars = CHARS, uuid = new Array(36), rnd = 0, r;\r\n    for (var i = 0; i < 36; i++) {\r\n      if (i === 8 || i === 13 || i === 18 || i === 23) {\r\n        uuid[i] = '-';\r\n      } else if (i === 14) {\r\n        uuid[i] = '4';\r\n      } else {\r\n        if (rnd <= 0x02) rnd = 0x2000000 + (Math.random() * 0x1000000) | 0;\r\n        r = rnd & 0xf;\r\n        rnd = rnd >> 4;\r\n        uuid[i] = chars[(i === 19) ? (r & 0x3) | 0x8 : r];\r\n      }\r\n    }\r\n    return uuid.join('');\r\n  };\r\n\r\n  // A more compact, but less performant, RFC4122v4 solution:\r\n  static uuidCompact = function () {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n      // eslint-disable-next-line\r\n      var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  };\r\n\r\n}\r\n\r\n/**\r\n * 常用工具类\r\n */\r\nexport class Util {\r\n  /**\r\n   * 判断对象是否为空\r\n   * @param {object|array|string} obj 目标对象\r\n   * @param {boolean} [includeNull=true] 是否包含null\r\n   * @param {boolean} [includeUndefined=true] 是否包含undefined\r\n   * @returns {boolean} 为空时返回true\r\n   */\r\n  static isEmpty(obj, includeNull = true, includeUndefined = true) {\r\n    if (!includeNull && obj === null) {\r\n      return false;\r\n    }\r\n    if (!includeUndefined && obj === undefined) {\r\n      return false;\r\n    }\r\n    return obj === null || obj === undefined || Object.keys(obj).length === 0;\r\n  }\r\n}\r\n\r\nexport class ArrayUtil {\r\n  /**\r\n   * 获取数组的最后一个元素\r\n   * @param array\r\n   * @returns {*}\r\n   */\r\n  static getLast(array){\r\n    return array[array.length - 1];\r\n  }\r\n}\r\n","import {GuidUtil, Util} from \"../utils\";\r\n\r\nexport const NodeType = {\r\n  root: Symbol.for('rootNode'),\r\n  normal: Symbol.for('normalNode'),\r\n  leaf: Symbol.for('leafNode'),\r\n};\r\n\r\n/**\r\n * 任务\r\n * @param {string} id\r\n * @param {string} title 任务名称\r\n * @param {string} description 任务详细描述\r\n * @param {bool} completed 任务是否完成\r\n * @param {bool} expanded 任务是否展开\r\n * @param {Mission[]} children 子任务\r\n */\r\nexport class Mission{\r\n  id = '';\r\n  title = '';\r\n  description = '';\r\n  completed = false;\r\n  expanded = false;\r\n  children = null;\r\n  parent = null;\r\n  type = NodeType.normal;\r\n\r\n  constructor(title) {\r\n    this.id = GuidUtil.uuid(); // guid\r\n    this.title = title;\r\n  }\r\n}\r\n\r\nexport class RootMission extends Mission{\r\n\r\n  type = NodeType.root;\r\n\r\n  constructor() {\r\n    super('root node');\r\n    this.children = [];\r\n  }\r\n\r\n}\r\n\r\n\r\n/**\r\n * 修改子节点的父节点指针为当前父节点\r\n * @param {Mission} parentNode\r\n * @returns {Mission}\r\n */\r\nfunction redirectParentPointer(parentNode){\r\n  parentNode.children.forEach(node=>{\r\n    node.parent = parentNode;\r\n  });\r\n  return parentNode;\r\n}\r\n\r\n/**\r\n * 任务相关工厂方法\r\n */\r\nexport class MissionFactory{\r\n  /**\r\n   * 复制\r\n   * @param mission\r\n   * @returns {Mission}\r\n   */\r\n  static clone(mission){\r\n    switch(mission.type){\r\n      case NodeType.root:{\r\n        return Object.assign(new RootMission(),mission);\r\n      }\r\n      default:{\r\n        return Object.assign(new Mission(),mission);\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * 添加任务\r\n   * @param parentNode\r\n   * @param mission\r\n   * @returns\r\n   * 返回新的父节点，并将原来此父节点下的所有子节点的父节点指针修改为新的父节点\r\n   */\r\n  static append(parentNode,mission){\r\n\r\n    const targetParentNode = MissionFactory.clone(parentNode);\r\n    if(targetParentNode.children){\r\n      // 子节点已存在\r\n      targetParentNode.children = [...targetParentNode.children,mission];\r\n    }else{\r\n      // 子节点不存在\r\n      targetParentNode.children = [mission];\r\n    }\r\n    // 重写父节点指针指向新的父节点\r\n    redirectParentPointer(targetParentNode);\r\n    return targetParentNode;\r\n  }\r\n\r\n  /**\r\n   * 修改任务\r\n   * @param parentNode\r\n   * @param mission\r\n   */\r\n  static update(parentNode,mission){\r\n    // 修改目标节点为修改后的节点\r\n    const targetParentNode = MissionFactory.clone(parentNode);\r\n    targetParentNode.children = parentNode.children.map(node=>{\r\n      if(node.id === mission.id){\r\n        return mission;\r\n      }else{\r\n        return node;\r\n      }\r\n    });\r\n\r\n    // 如果子节点还有子节点，则更新子节点的父节点指针指向新生成的子节点\r\n    if(!Util.isEmpty(mission.children)){\r\n      mission.children.forEach(item=>{\r\n        item.parent = mission;\r\n      })\r\n    }\r\n\r\n    // 重写父节点指针指向新的父节点\r\n    redirectParentPointer(targetParentNode);\r\n    return targetParentNode;\r\n  }\r\n\r\n  /**\r\n   * 删除任务\r\n   * @param parentNode\r\n   * @param mission\r\n   */\r\n  static delete(parentNode,mission){\r\n    const targetParentNode = MissionFactory.clone(parentNode);\r\n    targetParentNode.children = parentNode.children.filter(node=>{\r\n      return node.id !== mission.id;\r\n    });\r\n\r\n    // 重写父节点指针指向新的父节点\r\n    redirectParentPointer(targetParentNode);\r\n    return targetParentNode;\r\n  }\r\n\r\n  /**\r\n   * 插入任务\r\n   * @param parentNode\r\n   * @param mission\r\n   * @param index\r\n   */\r\n  static insert(parentNode,mission,index){\r\n    const targetParentNode = MissionFactory.clone(parentNode);\r\n    if(targetParentNode.children){\r\n      // 子节点已存在\r\n      targetParentNode.children = [...targetParentNode.children.slice(0,index),mission,...targetParentNode.children.slice(index)];\r\n    }else{\r\n      // 子节点不存在\r\n      targetParentNode.children = [mission];\r\n    }\r\n    // 重写父节点指针指向新的父节点\r\n    redirectParentPointer(targetParentNode);\r\n    return targetParentNode;\r\n  }\r\n\r\n  /**\r\n   * 刷新目标节点\r\n   * @param {Mission} parentNode\r\n   * @param {Mission} node\r\n   */\r\n  static refreshNode(parentNode,node){\r\n    if(node.id === parentNode.id){\r\n      return node;\r\n    }\r\n    let pointer = node;\r\n    while(true){\r\n      const tempParentNode = pointer.parent;\r\n      if(tempParentNode === parentNode){\r\n        break;\r\n      }\r\n\r\n      if(tempParentNode.type === NodeType.root){\r\n        throw new Error('无效的父节点');\r\n      }\r\n\r\n      pointer = tempParentNode;\r\n    }\r\n\r\n\r\n    if(node.parent === parentNode){\r\n      return MissionFactory.update(node.parent,node);\r\n    }else{\r\n      const tempNode = MissionFactory.update(node.parent,node);\r\n      return MissionFactory.refreshNode(parentNode,tempNode);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 转为json\r\n   * @param mission\r\n   * @returns {string}\r\n   */\r\n  static convertToJson(mission) {\r\n    const data = convertMissionToData(mission);\r\n    return JSON.stringify(data);\r\n  }\r\n\r\n  /**\r\n   * 从json创建Mission\r\n   * @param json\r\n   * @returns {Mission}\r\n   */\r\n  static createFromJson(json){\r\n    const data = JSON.parse(json);\r\n    const mission = convertDataToMission(data);\r\n    return mission;\r\n  }\r\n\r\n  /**\r\n   * 解析附加信息\r\n   * @param {Mission} mission\r\n   * @returns\r\n   * {\r\n   *   completedKeys: [], // 完成的任务ID\r\n   *   expandedKeys: [], // 展开的任务ID\r\n   * }\r\n   */\r\n  static parseExtraInfo(mission) {\r\n    const extraInfo = {\r\n      completedKeys: new Set(),\r\n      expandedKeys: new Set(),\r\n    };\r\n    if(mission.completed){\r\n      extraInfo.completedKeys.add(mission.id);\r\n    }\r\n    if(mission.expanded){\r\n      extraInfo.expandedKeys.add(mission.id);\r\n    }\r\n    if(!Util.isEmpty(mission.children)){\r\n      mission.children.forEach(mission=>{\r\n        const {completedKeys,expandedKeys} = MissionFactory.parseExtraInfo(mission);\r\n        [...completedKeys].forEach(key=>{\r\n          extraInfo.completedKeys.add(key);\r\n        });\r\n        [...expandedKeys].forEach(key=>{\r\n          extraInfo.expandedKeys.add(key);\r\n        });\r\n      })\r\n    }\r\n    return extraInfo;\r\n  }\r\n}\r\n\r\n/**\r\n * 将Mission转为纯数据对象\r\n * @param mission\r\n * @returns {object}\r\n */\r\nfunction convertMissionToData(mission){\r\n  // 常规字段赋值\r\n  const {parent,children,type,...data} = mission;\r\n\r\n  // type赋值\r\n  data.type = Symbol.keyFor(type);\r\n\r\n  // children赋值\r\n  if(children){\r\n    data.children = children.map(item=>{\r\n      return convertMissionToData(item);\r\n    })\r\n  }else{\r\n    data.children = null;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n/**\r\n * 将纯数据对象转为Mission\r\n * @param data\r\n * @param {Mission} [parent=null] 父节点，默认为空\r\n * @returns {Mission}\r\n */\r\nfunction convertDataToMission(data,parent=null){\r\n  // 常规赋值\r\n  const {type,children,...missionData} = data;\r\n\r\n  let mission;\r\n  switch(Symbol.for(type)){\r\n    case NodeType.root: {\r\n      mission = new RootMission();\r\n      break;\r\n    }\r\n    default:{\r\n      mission = new Mission();\r\n    }\r\n  }\r\n  Object.assign(mission,missionData);\r\n\r\n  // type赋值\r\n  mission.type = Symbol.for(type);\r\n\r\n  // children赋值\r\n  if(children){\r\n    mission.children = children.map(item=>{\r\n      return convertDataToMission(item,mission);\r\n    })\r\n  }else{\r\n    mission.children = null;\r\n  }\r\n\r\n  // parent赋值\r\n  mission.parent = parent;\r\n\r\n  return mission;\r\n}\r\n","import React from \"react\";\r\nimport * as PropTypes from \"prop-types\";\r\nimport {Mission} from \"../model/Mission\";\r\nimport {Button, Form, Input} from \"antd\";\r\n\r\nconst EditType = {\r\n  insert: Symbol.for('insert'),\r\n  update: Symbol.for('update'),\r\n  delete: Symbol.for(\"delete\"),\r\n};\r\nclass MissionEditor extends React.Component{\r\n\r\n  static propTypes = {\r\n    mission: PropTypes.instanceOf(Mission),\r\n    onChange: PropTypes.func.isRequired,\r\n    onCancel: PropTypes.func.isRequired,\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.mission = this.props.mission || new Mission('');\r\n    this.editType = this.props.mission ? EditType.update : EditType.insert\r\n  }\r\n\r\n  handleSubmit = (event) =>{\r\n    event.preventDefault();\r\n    this.props.form.validateFields((errors, values) => {\r\n      if(!errors){\r\n        const mission = {...this.mission,...values};\r\n\r\n        // 返回修改后的mission\r\n        this.props.onChange(mission);\r\n      }\r\n    })\r\n  };\r\n\r\n  render() {\r\n    const {getFieldDecorator} = this.props.form;\r\n    let {mission} = this;\r\n    return (\r\n      <Form onSubmit={this.handleSubmit}>\r\n        <Form.Item label={\"任务ID\"} hidden>\r\n          {getFieldDecorator('id',{\r\n            initialValue: mission.id,\r\n          })(<Input readOnly/>)}\r\n        </Form.Item>\r\n        <Form.Item label=\"任务名称\">\r\n          {getFieldDecorator('title',{\r\n            initialValue: mission.title,\r\n            rules: [\r\n              {required: true,message:'请输入任务名称'}\r\n            ]\r\n          })(<Input />)}\r\n        </Form.Item>\r\n        <Form.Item label=\"任务详情\">\r\n          {getFieldDecorator('description',{\r\n            initialValue: mission.description\r\n          })(<Input />)}\r\n        </Form.Item>\r\n        <Form.Item>\r\n          <Button type=\"primary\" htmlType=\"submit\" block>{formatButtonText(this.editType)}</Button>\r\n          <Button type=\"default\" block onClick={this.props.onCancel}>取消</Button>\r\n        </Form.Item>\r\n      </Form>\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * 格式化按钮文字\r\n * @param editType\r\n */\r\nfunction formatButtonText(editType){\r\n  switch(editType){\r\n    case EditType.update:{\r\n      return '修改';\r\n    }\r\n    case EditType.insert:{\r\n      return '新增';\r\n    }\r\n    default: {\r\n      return '保存';\r\n    }\r\n  }\r\n}\r\n\r\nconst WrappedMissionEditor = Form.create()(MissionEditor);\r\nWrappedMissionEditor.propTypes = MissionEditor.propTypes;\r\n\r\nexport default WrappedMissionEditor;\r\n","import React from 'react';\r\nimport * as PropTypes from 'prop-types';\r\nimport {Row, Col, Typography, List, Button, Modal, Tree, Checkbox, Switch} from 'antd';\r\nimport {MissionFactory, NodeType, RootMission} from \"../model/Mission\";\r\nimport MissionEditor from \"./MissionEditor\";\r\n\r\nimport './TodoList.css';\r\nimport {ArrayUtil, Util} from \"../utils\";\r\n\r\nexport default class TodoList extends React.Component{\r\n  static propTypes = {\r\n    rootMission: PropTypes.instanceOf(RootMission).isRequired,\r\n    onChange: PropTypes.func.isRequired, // 数据变化\r\n    onSave: PropTypes.func.isRequired, // 保存\r\n    onImport: PropTypes.func.isRequired, // 导入\r\n    onExport: PropTypes.func.isRequired, // 导出\r\n  };\r\n\r\n  state = {\r\n    showCompleted: false\r\n  };\r\n\r\n  openEditor = (mission) => {\r\n    const promise = new Promise((resolve)=>{\r\n      const modal = Modal.info({\r\n        icon: null,\r\n        okButtonProps: {style:{display: 'none'}},\r\n        content: (\r\n          <MissionEditor\r\n            mission={mission}\r\n            onChange={(mission)=>{resolve(mission);modal.destroy();}}\r\n            onCancel={()=>{modal.destroy()}}\r\n          />\r\n        )\r\n      });\r\n    });\r\n    const editor = {\r\n      onChange: (callback) => {\r\n        promise.then((mission)=>{\r\n          callback(mission);\r\n        })\r\n      }\r\n    };\r\n    return editor;\r\n  };\r\n\r\n  refreshNode = (node) => {\r\n    const rootNode = this.props.rootMission;\r\n    if(node.type === NodeType.root){\r\n      this.props.onChange(node);\r\n    }else{\r\n      this.props.onChange(MissionFactory.refreshNode(rootNode,node));\r\n    }\r\n\r\n  };\r\n\r\n  handleCompletedChange = (checkedKeys,event) => {\r\n    const checked = event.checked;\r\n    const mission = event.node.props['data-mission'];\r\n    this.refreshNode(Object.assign(MissionFactory.clone(mission),{completed:checked}));\r\n  };\r\n\r\n  /**\r\n   * 渲染树节点\r\n   * @param {Mission[]} nodes\r\n   * @returns {*}\r\n   */\r\n  renderTreeNodes = (nodes) => {\r\n    const {showCompleted} = this.state;\r\n    if(nodes){\r\n      return nodes.map( mission => {\r\n        return (\r\n          <Tree.TreeNode\r\n            className=\"treeNode\"\r\n            style={!showCompleted&&mission.completed?{display:'none'}:{}}\r\n            key={mission.id}\r\n            data-mission={mission}\r\n            title={(\r\n              <ol>\r\n                <List.Item className=\"mission\" actions={[<Button className=\"btn-hidden\" onClick={()=>{this.handleEdit(mission)}}>编辑</Button>,<Button className=\"btn-hidden\" onClick={()=>{this.handleDelete(mission)}}>删除</Button>,<Button className=\"btn-hidden\" onClick={()=>{this.handleAdd(mission)}}>添加</Button>]}>\r\n                  <List.Item.Meta title={mission.title} description={mission.description} />\r\n                </List.Item>\r\n              </ol>\r\n            )}\r\n          >\r\n            {!Util.isEmpty(mission.children) && this.renderTreeNodes(mission.children)}\r\n          </Tree.TreeNode>\r\n        )\r\n      });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * 渲染列表节点\r\n   * @param {Mission} mission\r\n   * @returns {*}\r\n   */\r\n  renderMission = (mission) => {\r\n    const {showCompleted} = this.state;\r\n    // TODO button传递mission存在效率问题，待优化\r\n    return (\r\n      <>\r\n        <List.Item hidden={!showCompleted&&mission.completed} className=\"mission\" actions={[<Button className=\"btn-hidden\" onClick={()=>{this.handleEdit(mission)}}>编辑</Button>,<Button className=\"btn-hidden\" onClick={()=>{this.handleDelete(mission)}}>删除</Button>,<Button className=\"btn-hidden\" onClick={()=>{this.handleAdd(mission)}}>添加</Button>]}>\r\n          <Checkbox checked={mission.completed} onChange={this.handleCompletedChange} data-mission={mission} style={{marginRight: '20px'}}/>\r\n          <List.Item.Meta title={mission.title} description={mission.description} />\r\n        </List.Item>\r\n        {mission.children && Object.keys(mission.children).length > 0 && <List style={{marginLeft: '20px'}} dataSource={mission.children} rowKey={(mission)=>mission.id} renderItem={(mission)=>{\r\n          return this.renderMission(mission);\r\n        }} />}\r\n      </>\r\n    )\r\n  };\r\n\r\n  /**\r\n   * 编辑Mission\r\n   * @param mission\r\n   */\r\n  handleEdit = (mission) => {\r\n    this.openEditor(mission).onChange((mission)=>{\r\n      this.refreshNode(mission);\r\n    })\r\n  };\r\n\r\n  /**\r\n   * 删除mission\r\n   * @param mission\r\n   */\r\n  handleDelete = (mission) => {\r\n    this.refreshNode(MissionFactory.delete(mission.parent,mission));\r\n  };\r\n\r\n  /**\r\n   * 添加子mission\r\n   * @param {Mission} parentMission\r\n   */\r\n  handleAdd = (parentMission) => {\r\n    this.openEditor().onChange((mission)=>{\r\n      this.refreshNode(MissionFactory.append(parentMission,mission));\r\n    });\r\n  };\r\n\r\n  handleShowCompletedChange = (showCompleted) => {\r\n    this.setState({showCompleted});\r\n  };\r\n\r\n  handleDrop = ({node,dragNode,dropPosition}) => {\r\n    // 命名规则 drop为拖拽终点，drag为拖拽目标\r\n\r\n    // 拖拽终点目标节点\r\n    const dropTargetNode = node;\r\n    // 拖拽终点目标节点的位置\r\n    const dropTargetPosition = parseInt(ArrayUtil.getLast(node.props.pos.split('-')));\r\n    // 拖拽终点相对目标节点的位置 -1 节点前 0 节点中 1 节点后\r\n    const relativePosition = dropPosition - dropTargetPosition;\r\n    // 拖拽终点任务节点\r\n    let dropTargetMission = dropTargetNode.props['data-mission'];\r\n    const dragMission = dragNode.props['data-mission'];\r\n\r\n    let rootMission = this.props.rootMission;\r\n\r\n    // step1 从原节点处删除拖拽节点\r\n    const newDeletedNode = MissionFactory.delete(dragMission.parent,dragMission);\r\n    rootMission = MissionFactory.refreshNode(rootMission,newDeletedNode);\r\n\r\n    // 删除拖拽节点后，会生成新的节点链，如果目标节点在新生成的节点链上，则后续插入操作需要在新的节点链上操作\r\n    let pointer = newDeletedNode;\r\n    while(true){\r\n      if(pointer.id === dropTargetMission.id){\r\n        dropTargetMission = pointer;\r\n        break;\r\n      }\r\n\r\n      if(pointer.type === NodeType.root){\r\n        break;\r\n      }\r\n\r\n      pointer = pointer.parent;\r\n    }\r\n\r\n    // step2 将拖拽节点复制到终点处\r\n    if(relativePosition === 0){\r\n      rootMission = MissionFactory.refreshNode(rootMission,MissionFactory.append(dropTargetMission,dragMission));\r\n    }else{\r\n      const dropTargetIndex = dropTargetMission.parent.children.indexOf(dropTargetMission);\r\n      const dropIndex = relativePosition===-1?dropTargetIndex:dropTargetIndex+1;\r\n      rootMission = MissionFactory.refreshNode(rootMission,MissionFactory.insert(dropTargetMission.parent,dragMission,dropIndex));\r\n    }\r\n    this.refreshNode(rootMission);\r\n\r\n  };\r\n\r\n  render() {\r\n    const missionList = this.props.rootMission.children;\r\n    const {completedKeys,expandedKeys} = MissionFactory.parseExtraInfo(this.props.rootMission);\r\n    return (\r\n      <>\r\n        <Row type=\"flex\" justify=\"center\">\r\n          <Col style={{textAlign:'center'}}>\r\n            <Typography.Title>I CAN DO</Typography.Title>\r\n            <Switch checkedChildren=\"显示已完成\" unCheckedChildren=\"隐藏已完成\" checked={this.state.showCompleted} onChange={this.handleShowCompletedChange}/>\r\n          </Col>\r\n        </Row>\r\n        <Row type=\"flex\" justify=\"space-around\" style={{minHeight: '50vh'}}>\r\n          <Col span={16}>\r\n            <Tree\r\n              blockNode\r\n              checkStrictly\r\n              checkable\r\n              checkedKeys={[...completedKeys]}\r\n              onCheck={this.handleCompletedChange}\r\n              draggable\r\n              onDrop={this.handleDrop}\r\n            >\r\n              {this.renderTreeNodes(missionList)}\r\n            </Tree>\r\n          </Col>\r\n          <Col span={10}>\r\n            <Button type=\"primary\" block onClick={()=>{this.handleAdd(this.props.rootMission)}}>add mission</Button>\r\n          </Col>\r\n        </Row>\r\n        <Row type=\"flex\" justify=\"center\">\r\n          <Col span={4}>\r\n            <Button type=\"default\" block onClick={this.props.onSave}>save</Button>\r\n          </Col>\r\n          <Col span={4}>\r\n            <Button type=\"default\" block onClick={this.props.onExport}>export</Button>\r\n          </Col>\r\n          <Col span={4}>\r\n            <Button type=\"default\" block onClick={this.props.onImport}>import</Button>\r\n          </Col>\r\n        </Row>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\n","import React from 'react';\r\nimport {MissionFactory, RootMission} from \"../model/Mission\";\r\n\r\nexport default function connectStorage(WrapperComponent){\r\n  return class Storage extends React.Component{\r\n\r\n    constructor(props){\r\n      super(props);\r\n      const rootMission = new RootMission();\r\n      this.state = {\r\n        rootMission: rootMission,\r\n        // TODO 增加missionMap，handleChange改为处理单个Mission，业务逻辑移到存储来处理\r\n        missionMap: {\r\n          [rootMission.id]: rootMission\r\n        }\r\n      };\r\n    }\r\n\r\n    componentDidMount() {\r\n      this.handleImportInit();\r\n      this.handleLoad();\r\n    }\r\n\r\n    handleChange = (rootMission) => {\r\n      this.setState({\r\n        rootMission\r\n      },this.handleSave);\r\n    };\r\n\r\n    handleSave = () => {\r\n      const jsonStr = MissionFactory.convertToJson(this.state.rootMission);\r\n      localStorage.setItem(\"rootMission\",jsonStr);\r\n      return Promise.resolve(jsonStr);\r\n    };\r\n\r\n    handleLoad = () => {\r\n      const rootMissionStr = localStorage.getItem(\"rootMission\");\r\n      if(rootMissionStr){\r\n        const rootMission = MissionFactory.createFromJson(rootMissionStr);\r\n        this.setState({\r\n          rootMission\r\n        })\r\n      }\r\n    };\r\n\r\n    handleExport = () => {\r\n      // 先保存\r\n      this.handleSave().then((jsonStr)=>{\r\n        const filename = 'icando.json';\r\n        const blob = new Blob([jsonStr],{type:'text/json'});\r\n        const a = document.createElement('a');\r\n        a.download = filename;\r\n        a.href = window.URL.createObjectURL(blob);\r\n        a.dataset.downloadurl = ['text/json', a.download, a.href].join(':');\r\n        a.click();\r\n      });\r\n    };\r\n\r\n    handleImportInit = () => {\r\n      const input = document.createElement('input');\r\n      input.type = 'file';\r\n      input.accept = '.json';\r\n      input.addEventListener('change',(event)=>{\r\n        const file = event.path[0].files.item(0);\r\n        const fileReader = new FileReader();\r\n        fileReader.onload = (event)=>{\r\n          const jsonStr = event.target.result;\r\n          const rootMission = MissionFactory.createFromJson(jsonStr);\r\n          this.setState({\r\n            rootMission\r\n          });\r\n        };\r\n        fileReader.readAsText(file);\r\n      });\r\n\r\n      this.importInput = input;\r\n    };\r\n\r\n    handleImport = () => {\r\n      this.importInput.click();\r\n    };\r\n\r\n    render() {\r\n      const {rootMission} = this.state;\r\n      return <WrapperComponent\r\n        {...this.props}\r\n        rootMission={rootMission}\r\n        onChange={this.handleChange}\r\n        onSave={this.handleSave}\r\n        onExport={this.handleExport}\r\n        onImport={this.handleImport}\r\n      />\r\n    }\r\n  }\r\n}\r\n\r\nexport const ChangeType = {\r\n  insert: Symbol.for('insert'),\r\n  update: Symbol.for('update'),\r\n  delete: Symbol.for('delete'),\r\n};\r\n","import React from 'react';\r\nimport './App.css';\r\nimport TodoList from \"./modules/TodoList\";\r\nimport connectStorage from \"./modules/Storage\";\r\n\r\n// 与存储连接，后续可以改为redux\r\nconst TodoListWithStorage = connectStorage(TodoList);\r\n\r\nfunction App() {\r\n  return (\r\n    <TodoListWithStorage />\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}